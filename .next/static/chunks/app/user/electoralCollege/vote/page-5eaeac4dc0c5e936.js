(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[194],{5388:function(e,a,t){Promise.resolve().then(t.bind(t,6483))},6483:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return b}});var s=t(7437),l=t(2265),n=t(3514),i=t(4175),o=t(2421),r=t(495),c=t(6466),d=t(6910),g=t(6975),h=t(8472),u=t(6780),x=t(4867),m=t(6294);function p(e){let{table:a}=e;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)("div",{className:"flex items-center justify-between px-2",children:(0,s.jsxs)("div",{className:"flex items-center space-x-6 lg:space-x-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("p",{className:"text-sm text-muted-foreground ",children:"Rows per page"}),(0,s.jsxs)(m.Ph,{value:"".concat(a.getState().pagination.pageSize),onValueChange:e=>{a.setPageSize(Number(e))},children:[(0,s.jsx)(m.i4,{className:"h-8 w-[70px]",children:(0,s.jsx)(m.ki,{placeholder:a.getState().pagination.pageSize})}),(0,s.jsx)(m.Bw,{side:"top",children:[5,10,20,30,40,50].map(e=>(0,s.jsx)(m.Ql,{value:"".concat(e),children:e},e))})]})]}),(0,s.jsxs)("div",{className:"flex w-[100px] items-center justify-center text-sm font-medium",children:["Page ",a.getState().pagination.pageIndex+1," of"," ",a.getPageCount()]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)(r.z,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(0),disabled:!a.getCanPreviousPage(),children:[(0,s.jsx)("span",{className:"sr-only",children:"Go to first page"}),(0,s.jsx)(x.kRt,{className:"h-4 w-4"})]}),(0,s.jsxs)(r.z,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.previousPage(),disabled:!a.getCanPreviousPage(),children:[(0,s.jsx)("span",{className:"sr-only",children:"Go to previous page"}),(0,s.jsx)(x.wyc,{className:"h-4 w-4"})]}),(0,s.jsxs)(r.z,{variant:"outline",className:"h-8 w-8 p-0",onClick:()=>a.nextPage(),disabled:!a.getCanNextPage(),children:[(0,s.jsx)("span",{className:"sr-only",children:"Go to next page"}),(0,s.jsx)(x.XCv,{className:"h-4 w-4"})]}),(0,s.jsxs)(r.z,{variant:"outline",className:"hidden h-8 w-8 p-0 lg:flex",onClick:()=>a.setPageIndex(a.getPageCount()-1),disabled:!a.getCanNextPage(),children:[(0,s.jsx)("span",{className:"sr-only",children:"Go to last page"}),(0,s.jsx)(x.yr4,{className:"h-4 w-4"})]})]})]})})})}var j=t(809),f=t(3102);function w(e){var a,t;let{table:n}=e,[i,o]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/voter-areas"),a=await e.json();console.log("Fetched data:",a);let t=a.map(e=>({label:e,value:e}));o(t),console.log("Areas fetched and mapped successfully"),console.log(t)}catch(e){console.error("Error fetching areas:",e)}})()},[]);let c=n.getState().columnFilters.length>0;return console.log(n.getState().columnFilters),(0,s.jsx)("div",{className:"flex items-center justify-between",children:(0,s.jsxs)("div",{className:"flex flex-1 items-center space-x-2",children:[(0,s.jsx)(f.I,{placeholder:"Search...",value:null!==(t=null===(a=n.getColumn("name"))||void 0===a?void 0:a.getFilterValue())&&void 0!==t?t:"",onChange:e=>{var a;return null===(a=n.getColumn("name"))||void 0===a?void 0:a.setFilterValue(e.target.value)},className:"h-8 w-[150px] lg:w-[250px]"}),c&&(0,s.jsxs)(r.z,{variant:"ghost",onClick:()=>n.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",(0,s.jsx)(x.Pxu,{className:"ml-2 h-4 w-4"})]})]})})}var v=t(7776),C=t(9896);function N(e){var a,t;let{election:x,user:m}=e,[f,N]=(0,l.useState)(!0),S=[{id:"select",header:e=>{let{table:a}=e;return(0,s.jsx)(c.X,{checked:a.getIsAllPageRowsSelected()||a.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:e=>a.toggleAllPageRowsSelected(!!e),"aria-label":"Select all"})},cell:e=>{let{row:a}=e;return(0,s.jsx)(c.X,{checked:a.getIsSelected(),onCheckedChange:e=>a.toggleSelected(!!e),"aria-label":"Select row"})},enableSorting:!1,enableHiding:!0},{accessorKey:"candidate_id",header:"ID"},{accessorKey:"name",header:"Name"},{accessorKey:"unit",header:"Unit"},{accessorKey:"area",header:"Area",filterFn:(e,a,t)=>{let s=e.getValue(a);return Array.isArray(t)?t.some(e=>s.toLowerCase().includes(e.toLowerCase())):s.toLowerCase().includes(t.toLowerCase())}},{accessorKey:"phone",header:"Phone"}],[y,b]=l.useState([]);l.useEffect(()=>{console.log("Election:",x),(async()=>{try{let e=(await h.Z.get("/api/ec-candidates",{params:{area:null==m?void 0:m.area}})).data.filter(e=>e.candidate_id!==(null==m?void 0:m.voter_id));b(e),N(!1)}catch(e){e instanceof Error?alert("Error fetching data: "+e.message):alert("An unknown error occurred")}})()},[]);let[P,k]=l.useState([]),[R,A]=l.useState([]),[E,_]=l.useState({name:!0,area:!0,unit:!0,phone:!1}),[V,F]=l.useState({}),M=(null==m?void 0:m.area)&&null!==(t=null==x?void 0:x.perAreaNominees[m.area])&&void 0!==t?t:1,I=(0,n.b7)({data:y,columns:S,onSortingChange:k,onColumnFiltersChange:A,getCoreRowModel:(0,i.sC)(),getPaginationRowModel:(0,i.G_)(),getSortedRowModel:(0,i.tj)(),getFilteredRowModel:(0,i.vL)(),onColumnVisibilityChange:_,onRowSelectionChange:e=>{let a="function"==typeof e?e(V):e;Object.values(a).filter(Boolean).length<=M?F(a):v.A.error("Please select ".concat(M," candidates"))},state:{sorting:P,columnFilters:R,columnVisibility:E,rowSelection:V}}),[z,G]=l.useState([]);l.useEffect(()=>{G(I.getSelectedRowModel().rows.map(e=>e.original._id))},[I.getSelectedRowModel().rows]);let L=async()=>{if(console.log("Voting for:",z),z.length<M){v.A.error("Please select ".concat(M," candidates"));return}try{await h.Z.post("/api/vote/".concat(null==m?void 0:m.voter_id),{candidateVotes:z}),await (0,j.Qk)(),alert("Voting successful"),window.location.href="/"}catch(e){v.A.error("Error voting: "+e)}};return f?(0,s.jsx)(C.Z,{}):(0,s.jsxs)("div",{className:"w-full",children:[(0,s.jsxs)("div",{className:"flex items-center py-4",children:[(0,s.jsx)(w,{table:I}),(0,s.jsxs)(d.h_,{children:[(0,s.jsx)(d.$F,{asChild:!0,children:(0,s.jsxs)(r.z,{variant:"outline",className:"ml-auto",children:["View ",(0,s.jsx)(o.Z,{className:"ml-2 h-4 w-4"})]})}),(0,s.jsx)(d.AW,{align:"end",children:I.getAllColumns().filter(e=>e.getCanHide()).map(e=>(0,s.jsx)(d.bO,{className:"capitalize",checked:e.getIsVisible(),onCheckedChange:a=>e.toggleVisibility(!!a),children:e.id},e.id))})]})]}),(0,s.jsx)("div",{className:"rounded-md border",children:(0,s.jsxs)(g.iA,{children:[(0,s.jsx)(g.xD,{children:I.getHeaderGroups().map(e=>(0,s.jsx)(g.SC,{children:e.headers.map(e=>(0,s.jsx)(g.ss,{children:e.isPlaceholder?null:(0,n.ie)(e.column.columnDef.header,e.getContext())},e.id))},e.id))}),(0,s.jsx)(g.RM,{children:(null===(a=I.getRowModel().rows)||void 0===a?void 0:a.length)?I.getRowModel().rows.map(e=>(0,s.jsx)(g.SC,{"data-state":e.getIsSelected()&&"selected",children:e.getVisibleCells().map(e=>(0,s.jsx)(g.pj,{children:(0,n.ie)(e.column.columnDef.cell,e.getContext())},e.id))},e.id)):(0,s.jsx)(g.SC,{children:(0,s.jsx)(g.pj,{colSpan:S.length,className:"h-24 text-center",children:"No results."})})})]})}),(0,s.jsx)("div",{className:"flex items-center justify-end space-x-2 py-4",children:(0,s.jsx)(p,{table:I})}),(0,s.jsxs)("div",{className:"flex items-center justify-around space-x-2 py-4 px-4",children:[(0,s.jsxs)("div",{className:"flex-1 text-sm text-muted-foreground",children:[I.getFilteredSelectedRowModel().rows.length," of"," ",I.getFilteredRowModel().rows.length," row(s) selected."]}),(0,s.jsxs)(u.aR,{children:[(0,s.jsx)(u.vW,{asChild:!0,children:(0,s.jsx)(r.z,{onClick:()=>console.log(I.getSelectedRowModel().rows),children:"Vote"})}),(0,s.jsxs)(u._T,{children:[(0,s.jsxs)(u.fY,{children:[(0,s.jsx)(u.f$,{children:"Are you absolutely sure?"}),(0,s.jsx)(u.yT,{children:I.getSelectedRowModel().rows.map(e=>(0,s.jsx)("p",{children:"ID: ".concat(e.original.candidate_id,", Area: ").concat(e.original.area,", Name: ").concat("object"==typeof e.original.name?JSON.stringify(e.original.name):e.original.name)},e.id))})]}),(0,s.jsxs)(u.xo,{children:[(0,s.jsx)(u.le,{children:"Cancel"}),(0,s.jsx)(u.OL,{onClick:()=>L(),children:"Continue"})]})]})]})]})]})}var S=t(6463),y=t(9809);function b(){let e=(0,S.useRouter)(),[a,t]=(0,l.useState)(null),{user:n}=(0,y.a)();return(0,l.useEffect)(()=>{document.title="Vote | Intekhaab",async function(){await h.Z.get("/api/election").then(a=>{"Electoral College"!==a.data[0].type?(alert("You are not allowed to access this page"),e.push("/")):("ongoing"!==a.data[0].status?(v.A.error("Election not yet started "),e.push("/user")):"completed"===a.data[0].status&&(v.A.error("Election is completed"),e.push("/user")),t(a.data[0]))}).catch(a=>{console.log(a),alert("Something went wrong"),e.push("/")})}(),console.log("Passing user",n),console.log("Passing election",a)},[e]),(0,s.jsx)("div",{children:a&&n&&(0,s.jsx)(N,{election:a,user:n})})}}},function(e){e.O(0,[310,32,472,776,534,208,424,82,306,971,23,744],function(){return e(e.s=5388)}),_N_E=e.O()}]);