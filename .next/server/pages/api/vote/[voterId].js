"use strict";(()=>{var e={};e.id=350,e.ids=[350],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},92824:e=>{e.exports=require("next/server")},16689:e=>{e.exports=require("react")},99369:e=>{e.exports=import("jose")},32940:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{config:()=>c,default:()=>u,routeModule:()=>l});var a=t(71802),o=t(47153),i=t(56249),s=t(43862),d=e([s]);s=(d.then?(await d)():d)[0];let u=(0,i.l)(s,"default"),c=(0,i.l)(s,"config"),l=new a.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/vote/[voterId]",pathname:"/api/vote/[voterId]",bundlePath:"",filename:""},userland:s});n()}catch(e){n(e)}})},55320:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.d(r,{je:()=>s});var a=t(99369);t(53121),t(92824);var o=e([a]);a=(o.then?(await o)():o)[0];let d=process.env.SECRET_KEY,u=new TextEncoder().encode(d),c=process.env.ADMIN_SECRET_KEY;async function i(e){try{let{payload:r}=await (0,a.jwtVerify)(e,u,{algorithms:["HS256"]});return r}catch(e){if("ERR_JWT_EXPIRED"===e.code)throw Error("Token has expired");throw Error("Token verification failed")}}async function s(e){try{return await i(e)}catch(e){return null}}new TextEncoder().encode(c),n()}catch(e){n(e)}})},63691:(e,r,t)=>{t.d(r,{Z:()=>i});var n=t(11185),a=t.n(n);let o=new(a()).Schema({candidate_id:{type:String,required:!0},name:{type:String,required:!0},phone:{type:String,required:!0},date_of_birth:{type:String,required:!0},unit:{type:String,required:!0},area:{type:String,required:!0},votes:{type:Number,required:!0}}),i=a().models.Candidate||a().model("Candidate",o)},8614:(e,r,t)=>{t.d(r,{Z:()=>i});var n=t(11185),a=t.n(n);let o=new(a()).Schema({voter_id:{type:String,required:!0},name:{type:String,required:!0},phone:{type:String,required:!0},date_of_birth:{type:String,required:!0},unit:{type:String,required:!0},area:{type:String,required:!0},verified:{type:Boolean,required:!0},present:{type:Boolean,required:!0},voted:{type:Boolean,required:!0}}),i=a().models.Voter||a().model("Voter",o)},43862:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{default:()=>u});var a=t(60578),o=t(63691),i=t(8614),s=t(55320),d=e([s]);async function u(e,r){let{voterId:t}=e.query;if(!await (0,s.je)(e.headers.cookie?.split("; ").find(e=>e.startsWith("session="))?.split("=")[1]))return r.status(401).json({error:"Unauthorized"});if(!t)return r.status(400).json({error:"Voter ID is required"});if("POST"===e.method)try{let{candidateVotes:n}=e.body;if(!Array.isArray(n))return console.error("Invalid input format: candidateVotes is not an array"),r.status(400).send({error:"Invalid input format"});if(0===n.length)return console.error("Invalid input format: candidateVotes array is empty"),r.status(400).send({error:"Invalid input format"});await (0,a.v)();let s=n.map(e=>({updateOne:{filter:{_id:e},update:{$inc:{votes:1}}}}));await o.Z.bulkWrite(s),await i.Z.findOneAndUpdate({voter_id:t},{$set:{voted:!0}},{new:!0}),r.status(200).send({message:"Votes updated successfully"})}catch(e){console.error("Error updating votes:",e),r.status(500).send({error:"Internal Server Error",details:e.message})}}s=(d.then?(await d)():d)[0],n()}catch(e){n(e)}})},60578:(e,r,t)=>{t.d(r,{v:()=>s});var n=t(11185),a=t.n(n);let o="mongodb://tauseef:s10secqJg0UlWLL@mongodb:27017/intekhaab?authSource=admin";if(!o)throw Error("Please define the NEXT_PUBLIC_MONGODB_URI environment variable inside .env.local");let i=global.mongoose;async function s(){if(i.conn)return i.conn;i.promise||(i.promise=a().connect(o,{useNewUrlParser:!0,useUnifiedTopology:!0}).then(e=>e));try{i.conn=await i.promise}catch(e){throw console.error("Database connection failed:",e),Error("Database connection failed")}return i.conn}i||(i=global.mongoose={conn:null,promise:null})}};var r=require("../../../webpack-api-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[643],()=>t(32940));module.exports=n})();